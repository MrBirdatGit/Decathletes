<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="zh-CN">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="zh-CN">
<![endif]-->
<!--[if !(IE 7) & !(IE 8)]><!-->
<html lang="zh-CN">
<!--<![endif]-->
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<title>BestCoder Blog | BestCoder 官方博客</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="pingback" href="http://bestcoder.hdu.edu.cn/blog/xmlrpc.php" />
<!--[if lt IE 9]>
<script src="http://bestcoder.hdu.edu.cn/blog/wp-content/themes/twentytwelve/js/html5.js" type="text/javascript"></script>
<![endif]-->
<link rel="alternate" type="application/rss+xml" title="BestCoder Blog &raquo; Feed" href="http://bestcoder.hdu.edu.cn/blog/feed/" />
<link rel="alternate" type="application/rss+xml" title="BestCoder Blog &raquo; 评论Feed" href="http://bestcoder.hdu.edu.cn/blog/comments/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/bestcoder.hdu.edu.cn\/blog\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.5.4"}};
			!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;if(!g||!g.fillText)return!1;switch(g.textBaseline="top",g.font="600 32px Arial",a){case"flag":return g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3;case"diversity":return g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,d=c[0]+","+c[1]+","+c[2]+","+c[3],g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e;case"simple":return g.fillText(h(55357,56835),0,0),0!==g.getImageData(16,16,1,1).data[0];case"unicode8":return g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='twentytwelve-style-css'  href='http://bestcoder.hdu.edu.cn/blog/wp-content/themes/twentytwelve/style.css?ver=4.5.4' type='text/css' media='all' />
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentytwelve-ie-css'  href='http://bestcoder.hdu.edu.cn/blog/wp-content/themes/twentytwelve/css/ie.css?ver=20121010' type='text/css' media='all' />
<![endif]-->
<script type='text/javascript' src='http://bestcoder.hdu.edu.cn/blog/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='http://bestcoder.hdu.edu.cn/blog/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<link rel='https://api.w.org/' href='http://bestcoder.hdu.edu.cn/blog/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://bestcoder.hdu.edu.cn/blog/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://bestcoder.hdu.edu.cn/blog/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.5.4" />
<link rel="icon" href="http://bestcoder.hdu.edu.cn/blog/wp-content/uploads/2015/08/cropped-logo-32x32.png" sizes="32x32" />
<link rel="icon" href="http://bestcoder.hdu.edu.cn/blog/wp-content/uploads/2015/08/cropped-logo-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="http://bestcoder.hdu.edu.cn/blog/wp-content/uploads/2015/08/cropped-logo-180x180.png" />
<meta name="msapplication-TileImage" content="http://bestcoder.hdu.edu.cn/blog/wp-content/uploads/2015/08/cropped-logo-270x270.png" />
<link rel="stylesheet" href="http://acm.hdu.edu.cn/assets/css/katex.min.css" />
</head>

<body class="home blog">
<div id="page" class="hfeed site">
	<header id="masthead" class="site-header" role="banner">
		<hgroup>
			<h1 class="site-title"><a href="http://bestcoder.hdu.edu.cn/blog/" title="BestCoder Blog" rel="home">BestCoder Blog</a></h1>
			<h2 class="site-description">BestCoder 官方博客</h2>
		</hgroup>

		<nav id="site-navigation" class="main-navigation" role="navigation">
			<button class="menu-toggle">菜单</button>
			<a class="assistive-text" href="#content" title="跳至内容">跳至内容</a>
			<div class="menu-%e9%a1%b6%e9%83%a8%e5%af%bc%e8%88%aa%e6%9d%a1-container"><ul id="menu-%e9%a1%b6%e9%83%a8%e5%af%bc%e8%88%aa%e6%9d%a1" class="nav-menu"><li id="menu-item-13" class="menu-item menu-item-type-custom menu-item-object-custom current-menu-item current_page_item menu-item-home menu-item-13"><a href="http://bestcoder.hdu.edu.cn/blog/">首页</a></li>
<li id="menu-item-15" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-15"><a href="http://bestcoder.hdu.edu.cn">BestCoder</a></li>
<li id="menu-item-16" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-16"><a href="http://acm.hdu.edu.cn">HDOJ</a></li>
</ul></div>		</nav><!-- #site-navigation -->

			</header><!-- #masthead -->

	<div id="main" class="wrapper">
	<div id="primary" class="site-content">
		<div id="content" role="main">
		
										
	<article id="post-520" class="post-520 post type-post status-publish format-standard hentry category-uncategorized">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="http://bestcoder.hdu.edu.cn/blog/2017-multi-university-training-contest-2-solutions-by-%e7%94%b5%e5%ad%90%e7%a7%91%e6%8a%80%e5%a4%a7%e5%ad%a6/" rel="bookmark">2017 Multi-University Training Contest 2 solutions BY 电子科技大学</a>
			</h1>
										<div class="comments-link">
					<a href="http://bestcoder.hdu.edu.cn/blog/2017-multi-university-training-contest-2-solutions-by-%e7%94%b5%e5%ad%90%e7%a7%91%e6%8a%80%e5%a4%a7%e5%ad%a6/#respond"><span class="leave-reply">发表回复</span></a>				</div><!-- .comments-link -->
					</header><!-- .entry-header -->

				<div class="entry-content markdown">
			<h2>1001：</h2><p>首先，我们统计出Derek和Alfia答案相同的题目数量k1和答案不同的题目数量k2. 对于两人答案相同的题目，共有以下两种情况：</p><ul><li>两人都对</li></ul><p>b.两人都错 对于两人答案不同的题目，共有以下三种情况： c.Derek对Alfia错 d.Alfia对Derek错 e.两人都错 于是我们可以列出一些方程： k1+k2=n a+b=k1 c+d+e=k2 a+c=x a+d=y 又a,b,c,d,e均为非负整数，且满足a,b&lt;=k1;c,d,e&lt;=k2 将a,b,d,e全部用c替换后需要同时满足以下四个条件： 0&lt;=c&lt;=k2 x-y&lt;=c&lt;=k2+x-y (x-y)/2&lt;=c&lt;=(k2+x-y)/2 x-k1&lt;=c&lt;=x 我们只需要判断这四段区间存不存在公共的整数点，如果存在，则说明Derek没有说谎；如果不存在，则说明Derek在说谎。</p><h2>1002：</h2><p>本题要求在1e6*1e6的矩形内找到一个特定的1e3*1e3的小矩形。 可以选择每隔K行或K列选出一个长宽皆为L的小矩形作为识别矩形，当识别矩形出现在输入矩形时，再进行完全匹配。根据鸽笼原理，当K+2*L&lt;=1000时，输入矩形一定覆盖了至少一个识别矩形。这里选择L=7使得可以用一个int表示一个识别矩形。将hash结果视为随机的，则识别矩形匹配成功进入完全匹配的次数约为(1e6/k)^2*(1e3)^2/2^49，为极小值。</p><h2>1003：</h2><p>预处理：a_i -= i ，易证明从最小的b开始选每次选最大的一定可以使结果最大。 证明思路：如果条件改为a_i&lt;=max{a_j-j|b_k&lt;=j&lt;=n}，那么b的顺序与最后的结果无关。条件改回来后，由于每次要计算一个数的最大值时都有a_(n+1)...a_(i-1)在范围中，所以每次只需让a_i - i尽可能大，那么就把大的数尽早用上，每次一定考虑尽量多的数字，这样取得的数字就尽可能的大。 所以说每次就是求区间最值，加在答案上。由于贪心的思路，每次要求的区间的下界是单调不降的，故可以用单调队列优化到O(n)的复杂度。 由于1 ≤ b_i ≤ n，对b排序可以用哈希排序（桶排序）完成。 进一步观察，可以发现这样贪心时 a_(n+1)...a_i 其实是单调不增的，所以并不需要每次求区间最值了，选第一个数时就选最大的，后面的选择顺序与最终结果无关了。</p><h2>1004：</h2><p>性质1：数列的相邻互换将改变逆序对数的奇偶性。 证明1：易得。 性质2：去掉空格，剩余的木板从左到右从上到下看做数列，【操作】不改变数列逆序对的奇偶性。 证明2：左右移动：生成数列不改变，逆序对不变；上下移动：相当于移动的木板向前或向后进行m-1次相邻互换，但是空格最终要回到右下角，总的上下移动为偶数，所以总的相邻互换为偶数，由性质1可得证。 性质3:所有局面都可通过一定的操作得到如下局面： 以4*7为例</p><table><tbody><tr><td width="37">1</td><td width="38">2</td><td width="37">3</td><td width="38">4</td><td width="37">5</td><td width="38">6</td><td width="37">7</td></tr><tr><td width="37">8</td><td width="38">9</td><td width="37">10</td><td width="38">11</td><td width="37">12</td><td width="38">13</td><td width="37">14</td></tr><tr><td width="37">15</td><td width="38">16</td><td width="37">17</td><td width="38">18</td><td width="37">19</td><td width="38">X</td><td width="37">X</td></tr><tr><td width="37">22</td><td width="38">23</td><td width="37">24</td><td width="38">25</td><td width="37">26</td><td width="38">X</td><td width="37"> </td></tr></tbody></table><p>证明3：</p><table><tbody><tr><td width="37">a</td><td width="38">b</td></tr><tr><td width="37">X</td><td width="38">X</td></tr><tr><td width="37">X</td><td width="38"> </td></tr></tbody></table><p>可以证明任意初始2*3局面，无论a、b初始在哪都可以通过一定操作使其位置如图所示。 证明脑补即可。     推广到任意局面：只需按顺序把数字当做a、b进行类似搬动，可保证性质3成立。       由以上性质，考虑完成性质3局面后右下角三个数字等价于2*2局面。 枚举所有6种2*2局面发现：相同逆序对奇偶性的局面可以互相到达。 所以只需考虑原排列的逆序对数的奇偶性:偶的“YES”，奇的“NO”；   按题意生成原始排列，观察发现，每一轮数后方比该数小的数的数量（即对逆序对数的贡献）呈等差数列形式，公差p-1，项数为（num-1）/p+1，照此简化计算，不需要正真求出排列。</p><h2>1005：</h2><p>这题由于n变为了3000，因此需要对两处都进行优化，预处理和暴力枚举的区间都要进行优化。预处理的时候会发现其实有很多无用状态，我们可以用la数组来防止这种现象的发生。这样就做到n^2的了。暴力枚举的时候你需要进行枚举两段就行了。这里有个细节就是你枚举删除的第一段的时候和最后一段留下的是要求连接在一起，因此这样会减去很多种无用情况，复杂度最坏情况只有n^2。</p><h2>1006：</h2><p>对于任意i&gt;=1，当j&gt;=3时，有 <a href="http://bestcoder.hdu.edu.cn/blog/wp-content/uploads/2017/07/1.png"><img class="alignnone size-full wp-image-521" src="http://bestcoder.hdu.edu.cn/blog/wp-content/uploads/2017/07/1.png" alt="1" width="178" height="28" /></a> 通过归纳法可以得到 <a href="http://bestcoder.hdu.edu.cn/blog/wp-content/uploads/2017/07/2.png"><img class="alignnone size-full wp-image-522" src="http://bestcoder.hdu.edu.cn/blog/wp-content/uploads/2017/07/2.png" alt="2" width="295" height="51" /></a> 进而推导出 <a href="http://bestcoder.hdu.edu.cn/blog/wp-content/uploads/2017/07/3.png"><img class="alignnone size-medium wp-image-523" src="http://bestcoder.hdu.edu.cn/blog/wp-content/uploads/2017/07/3-300x144.png" alt="3" width="300" height="144" /></a> 通过矩阵快速幂求解</p><h2>1007：</h2><p>令$g$为$p$的原根，$x=g^{a},y=g^{b}$,那么有$\left(g^{a} + g^{b} \right)^{i} = g^{ai} \% p$,即$\left(1 + g^{b-a} \right)^{i} = 1 \% p$,令$1 + g^{b-a} = g^{k}$,则有$g^{ki}=1 \% p$，即$ki \% \left(p - 1 \right) = 0$,因为$0 &lt; k &lt; p - 1$，所以$k$的取值有$gcd\left(i,p - 1 \right) - 1$个，递推回去，可知$x = y * inv \left(g^{k} - 1 \right)$,故$x$的取值也是$gcd\left(i,p - 1 \right) - 1$个.<br />所以我们最后只需要求$m \sum_{i=1}^{p-1} \left\{ i*gcd(i,p-1)-i \right\}$.<br />其中$\sum_{i=1}^{p-1}i$我们可以直接求出.<br />而另一部分$\sum_{i=1}^{p-1}i*gcd(i,p-1)$，我们可以通过枚举$gcd$的值，化为$\sum_{d|(p-1)}d^{2}\sum_{k=1}^{\frac{p-1}{d}}k*\left [ gcd\left ( k,\frac{p-1}{d} \right )=1 \right ]$,然后根据公式$\sum_{i=1}^{n} i*\left [ gcd\left ( i,n \right )=1\right ]= \left ( n\varphi \left ( n \right )+\left [ n=1 \right ]\right )/2$求解.</p><h2>1008：</h2><p>每种数可以单独算出其期望然后相加 对于数量小于13的数，可以用容斥的方式来做 对于大于13的数，可以求出全不含的矩阵个数，然后用全部矩阵减去这部分 复杂度 o(n^4/13*T)</p><h2>1009:</h2><p>令F(i)表示是i倍数的方案数，可以容易的通过预处理出前缀和后nlogn的时间内求出，之后利用预处理出莫比乌斯函数后进行简单的反演即可算出答案，加上快速幂，总复杂度nlogn^2</p><h2>1010:</h2><p>把T接在S后面，用后缀自动机构造出后缀树，求出他的dfs序（等同于后缀数组）。 这样之后，用树上倍增就可以找到T[a,b]所在的节点。 由于一颗子树在dfs序上是一段区间，我们就可以顺势求出那个节点的dfs所在区间。 我们知道在树上每个节点的right集是它子节点right集的并，我们知道这个节点的Right集是dfs序上的一段区间。 由于我们要求sum{f[yi]}，可以直接把right赋值为f[right],最后我们要求的就是这段区间right集中c&lt;=right&lt;=d的权值和sum{f[yi]}。 对于这个问题，由于有在线修改操作不能直接主席树完成。我们可以直接树状数组套权值线段树完成，或者常数更小的静态主席树+树状数组套权值线段树，或者树状数组套平衡树，时空复杂度nlognlogn。</p><h2>1011:</h2><p>题意，二维平面上给N个整数点，问能构成多少个不同的正多边形。 题解：容易得知只有正四边形可以使得所有的顶点为整数点。（具体证明可参考杨景钦在2017的国家队论文） 所以正解即求出所有的正四边形个数。 枚举2个点，然后暴力判断另外2个点的位置是否存在。 复杂度 N*N*logN。</p>					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			本条目发布于<a href="http://bestcoder.hdu.edu.cn/blog/2017-multi-university-training-contest-2-solutions-by-%e7%94%b5%e5%ad%90%e7%a7%91%e6%8a%80%e5%a4%a7%e5%ad%a6/" title="17:00" rel="bookmark"><time class="entry-date" datetime="2017-07-27T17:00:07+00:00">2017年7月27日</time></a>。属于<a href="http://bestcoder.hdu.edu.cn/blog/category/uncategorized/" rel="category tag">未分类</a>分类。<span class="by-author">作者是<span class="author vcard"><a class="url fn n" href="http://bestcoder.hdu.edu.cn/blog/author/sensible/" title="查看所有由sensible发布的文章" rel="author">sensible</a></span>。</span>								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-503" class="post-503 post type-post status-publish format-standard hentry category-duoxiao">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="http://bestcoder.hdu.edu.cn/blog/2017-multi-university-training-contest-8-solutions-by-%e5%8c%97%e4%ba%ac%e8%88%aa%e7%a9%ba%e8%88%aa%e5%a4%a9%e5%a4%a7%e5%ad%a6/" rel="bookmark">2017 Multi-University Training Contest 1 solutions BY 北京航空航天大学</a>
			</h1>
										<div class="comments-link">
					<a href="http://bestcoder.hdu.edu.cn/blog/2017-multi-university-training-contest-8-solutions-by-%e5%8c%97%e4%ba%ac%e8%88%aa%e7%a9%ba%e8%88%aa%e5%a4%a9%e5%a4%a7%e5%ad%a6/#comments">2条回复</a>				</div><!-- .comments-link -->
					</header><!-- .entry-header -->

				<div class="entry-content markdown">
			<h2>1001. Add More Zero</h2>
答案就是 $\left \lfloor \log_{10}(2^m - 1) \right \rfloor$，注意到不存在 $10^k = 2^m$ ，所以$\left \lfloor \log_{10}(2^m - 1) \right \rfloor = \left \lfloor \log_{10}{2^m} \right \rfloor = \left \lfloor m \log_{10}{2} \right \rfloor$，这样做的时间复杂度是 O(1) 。
<h2>1002. Balala Power!</h2>
每个字符对答案的贡献都可以看作一个 26 进制的数字，问题相当于要给这些贡献加一个 0 到 25 的权重使得答案最大。最大的数匹配 25，次大的数匹配 24，依次类推。排序后这样依次贪心即可，唯一注意的是不能出现前导 0。
<h2>1003. Colorful Tree</h2>
单独考虑每一种颜色，答案就是对于每种颜色至少经过一次这种的路径条数之和。反过来思考只需要求有多少条路径没有经过这种颜色即可。直接做可以采用虚树的思想（不用真正建出来），对每种颜色的点按照 dfs 序列排个序，就能求出这些点把原来的树划分成的块的大小。这个过程实际上可以直接一次 dfs 求出。
<h2>1004. Division Game</h2>
显然每个石子堆最多做 $\sum_{i = 1}^{m}{e_i}$ （记为 $w$ ）次操作。此外，如果定义一个堆做 $x$ 次操作恰好变为 $1$ 的方案数为 $f(x)$ ，显然每个数字做少于 $x$ 次操作不变为 $1$ 的方案数也是 $f(x)$ 。

为了统计结束于石子堆 $i$ 的情况数，我们可以枚举这是它第几次操作时结束的，不妨设为 $x$ ，则对应的方案数恰好是 $f(x + 1)^{i - 1} f(x)^{k - i + 1}$ ，因为编号小于等于 $i$ 的石子堆做了 $x$ 次操作不变为，其他石子堆做 $x - 1$ 次操作恰好变为 $1$ ，且只有石子堆 $i$ 变成了一个石子。因此我们在 O(w k) 时间复杂度下将问题规约到 $f(x)$ 的计算。

我们可以基于一个数的不同质因子几乎互不影响的观察得到第一个结论。每次操作保证任何一个 $e_i$ $(e_i &gt; 0)$ 可以减少且至少一个 $e_i$ 会减少。自然而然我们可以发现一个容斥关系。

考虑 $f(x)$ 的组成，不妨设在某种方案中第 $j$ 次操作使 $e_i$ 减少了 $d(i, j)$ （非负值）。我们知道对于每个 $e_i$ 有 $\sum_{j = 1}^{x}{d(i, j)} = e_i$ ，且对于每个 $j$ 有 $\sum_{i = 1}^{m}{d(i, j)} &gt; 0$ 。进一步我们能发现 $f(x)$ 也就是分配 $d(i, j)$ $(1 \leq i \leq m, 1 \leq j \leq x)$ 使其满足上述两个条件的方案数。

假设只满足第一个条件的相应方案数为 $g(x)$ ，我们可以发现每个 $i$ 分别对应一个组合问题，从而是有 $\displaystyle g(x) = \prod_{i = 1}^{m}{e_i + x - 1 \choose x - 1}$ 。

我们也可以观察到如果某些 $j$ 与第二个条件产生了矛盾，与之相关的 $d(i, j)$ 都会是零。利用容斥原理可以得到 $\displaystyle f(x) = \sum_{y = 0}^{x}{(-1)^{x - y} {x \choose y} g(y)}$ 。这个式子可以化为一个卷积式子 $\displaystyle \frac{f(x)}{x!} = \sum_{y = 0}^{x}{\frac{(-1)^{x - y}}{(x - y)!} \cdot \frac{g(y)}{y!}}$ 。因此你可以用一些方法来加速卷积，不过 $985661441 = 235 \times 2^{22} + 1$ 是一个特殊的质数，所以我们推荐使用 NTT 。

总时间复杂度为 O(w m + $w \log n$ + w k)，然而实现上谨慎一些也是很有必要的。
<h2>1005. Expectation Division</h2>
解决这道题需要观察到一些比较经典的结论。在分析前我们先两组与题目相关的定义：对于任意正整数的质因子分解 $n = \prod_{i = 1}^{k}{p_i^{e_i}}$ ，定义 $\omega(n) = k$ 表示 $n$ 的不同质因子个数， $\sigma(n) = \sum_{d | n}{1} = \sum_{i = 1}^{k}{(e_i + 1)}$ 表示 $n$ 的约数个数，显然有 $2^{\omega(n)} \leq \sigma(n)$ 。

这题本来是为 OI 赛制的比赛准备的，然而没有被使用。接下来会根据几个部分分给出做法，希望能对大家有所启发。

对于 $n \leq 10^6$ 的数据：

题目中所表述的过程是一个标准马尔可夫过程，所以我们可以用 $f(n)$ 表示使用这种操作把 $n$ 变成 $1$ 的期望试验次数，并且我们可以得到 $f(1) = 0,$ $\displaystyle f(n) = \frac{\sum_{d | n}{f(d)}}{\sum_{d | n}{1}} + 1$ ，化简后为 $\displaystyle f(n) = \frac{\sigma(n) + \sum_{d | n, d &lt; n}{f(d)}}{\sigma(n) - 1}$ 。

很容易计算出满足 $n \in N^{+},$ $n \leq N$ 的所有 $f(n)$ ，复杂度为 O($\sum_{n \leq N}{\sigma(n)}) = O(N\log N)$ ，这里不再赘述。

对于 $n \leq 10^{12}$ 的数据：

直接在线为每个询问计算答案是有些不现实的，这里给出一个考虑不同数字之间的关系并记忆化存储信息的做法。

首先观察到，对于 $n = \prod_{i = 1}^{k}{p_i^{e_i}},$ $m = \prod_{i=1}^{k'}{{p'_i}^{e'_i}}$ ，如果 $k = k'$ 并且对于 $i = 1, 2, \cdots, k$ 都有 $e_i = e'_i$ （适当地安排质因子的顺序之后），那么我们可以得到 $f(n) = f(m)$ ，这与具体的 $p_i, p'_i$ 是多少无关。

不妨将每个数字对应的 $e_1, e_2, \cdots, e_k$ 按非升序排序，可以观察到将这些幂指数的集合拿出来并去重后剩下集合的数量不会很多。对于一个集合 $e_1, e_2, \cdots, e_k$ （满足非升序），我们可以构造出可能的最小值 $n = 2^{e_1} 3^{e_2} 5^{e_3} 7^{e_4} \cdots$ ，而且可以大致估计出不超过 $N$ 的本质不同的幂指数的集合个数不会超过 $\log N$ 的分拆数数量，再利用搜索就可以确定实际的数量了，例如 $N = 10^{12}$ 时本质不同的集合个数为 $4357$ 。

事实上当 $n \leq 10^{12}$ 时，我们可以观察到 $\sigma(n) \leq 6720$ ，于是每次询问时将 $n$ 映射到其幂指数的集合上，利用记忆化搜索的技巧枚举约数即可以单次 O($\sigma(n))$ 的复杂度通过测试数据。

对于 $n \leq 10^{18}$ 的数据：

之前的方法难以奏效，因为现在有 $\sigma(n) \leq 103680$ 并且本质不同的集合个数达到 $32749$ 个。

为了观察更细致一些，我们定义 $g(n) = \sum_{d | n}{f(d)}$ ，记忆化搜索时先计算出满足 $d | n, d &lt; n$ 的所有 $f(d), g(d)$ ，然后依次计算出 $g'(n) = \sum_{d | n, d &lt; n}{f(d)},$ $f(n) = \frac{\sigma(n) + g'(n)}{\sigma(n) - 1},$ $g(n) = g'(n) + f(n)$ 。

尝试优化计算 $g'(n)$ 的过程，也即计算中的瓶颈部分。如果改用容斥的技巧，我们有 $\displaystyle g'(n) = \sum_{T \subseteq S}{(-1)^{|T| + 1} g\left(\frac{n}{\prod_{p_i \in T}{p_i}}\right)}$ ，其中 $S = \{p_i | i = 1, 2, \cdots, k\}$ ，这样可以使单次运算的复杂度从 $O(\sigma(n))$ 降到了 $O(2^{\omega(n)})$ 。

类似地，当 $n \leq 10^{18}$ 时，我们可以观察到 $\omega(n) \leq 15$ ，所以这个优化在实际运算中已经足以通过 $n \leq 10^{18}$ 的数据。

[b]对于 $n \leq 10^{24}$ 的数据：[/b]

上述做法再次不适用了，因为现在本质不同的集合个数达到 $172513$ 个，并且有 $2^{\omega(n)} \leq 2^{18} \leq 262144$ ，因此我们需要再次进行优化。

考虑 $g(n)$ 的组成，所有满足 $d = \prod_{i = 1}^{k}{{p_i}^{t_i}}$ 且对于 $i = 1, 2, \cdots, k$ 有 $0 \leq t_i \leq e_i$ 的 $d$ 都会对 $g(n)$ 贡献一个 $f(d)$ ，这本质上是 $k$ 维前缀和。

参考大小为 $k$ 的二进制子集求和（经典问题），我们可以定义 $g_x(n)$ 表示对于 $i = 1, 2, \cdots, x$ 有 $0 \leq t_i \leq e_i$ 且对于 $i = x + 1, x + 2, \cdots, k$ 有 $t_i = e_i$ 的 $f(d)$ 之和，而考虑 $i = x$ 时 $0 \leq t_i &lt; e_i$ 和 $t_i = e_i$ 这两种情况，不难得到 $g_x(n)$ 可以用 $g_{x - 1}(n)$ 和 $g_y(\frac{n}{p_x})$ 表示，其中 $y$ 取决于 $\frac{n}{p_x}$ 是否依旧能整除 $p_x$ 。这个方法可以将时间复杂度降低至每次 $O(\omega(n))$ 。

注意这个做法具体结合到非升序的幂指数序列时可能要修改一下 $g_x(n)$ 的定义。

复杂度分析：

这道题的大数运算很容易在常数时间内实现。记忆化搜索时可以用 bitset 配合基数排序线性地对幂指数序列的排序，但是它是可以避免的（甚至是递归时的拷贝）。标程的时间复杂度与空间复杂度都是 $O((S(N) + T) \omega(N))$ ，其中 $S(N)$ 表示在不超过 $N$ 的正整数里出现的本质不同的集合个数 $(S(N) \leq 172513)$ ， $T$ 表示数据组数，并且 $\omega(N) \leq 18$ 。
<h2>1006. Function</h2>
考虑置换 $a$ 的一个循环节，长度为 $l$ ，那么有 $f(i) = b_{f(a_i)} = b_{b_{f(a_{a_i})}} = \underbrace{b_{\cdots b_{f(i)}}}_{l\text{ times }b}$ 。

那么 $f(i)$ 的值在置换 $b$ 中所在的循环节的长度必须为 $l$ 的因数。

而如果 $f(i)$ 的值确定下来了，这个循环节的另外 $l - 1$ 个数的函数值也都确定下来了。

答案就是 $\sum_{i = 1}^{k} \sum_{j | l_i} {j \cdot cal_j}$ 改为 $\prod_{i = 1}^{k} \sum_{j | l_i} {j \cdot cal_j}$ ，其中 $k$ 是置换 $a$ 中循环节的个数， $l_i$ 表示置换 $a$ 中第 $i$ 个循环节的长度， $cal_j$ 表示置换 $b$ 中长度为 $j$ 的循环节的个数。

时间复杂度是 $\mathcal{O}(n + m)$ 。
<h2>1007. Gear Up</h2>
整个图的结构是一个森林，首先可以将共轴的齿轮看成一个块（它们角速度相同），再考虑共边的情况。

如果 $x$ 和 $y$ 共边， $x$ 的半径为 $r_x$ 、角速度为 $\omega_x$， $y$ 的半径为 $r_y$ 、角速度为 $\omega_y$ ，则可以知道 $\log\omega_y = \log\omega_x + \log r_x - \log r_y$ 。

由此可以得出每个连通分量中每个齿轮角速度与某个特定齿轮的关系，从而利用线段树维护齿轮（或块）的 dfs 序列对应的区间角速度最大值。具体来说，每个连通分量任选一个齿轮作为参照点，维护其他齿轮与其角速度的差值。每个连通分量可以看成是一棵有根树，当一个齿轮的半径发生变化时，根据其是 $r_x$ 还是 $r_y$ 分两种情况更新一段 dfs 序区间。查询时只需要得出对应连通分量中相对角速度的最大值，再与当前点的相对角速度进行对比即可算出实际的最大值。

具体实现中可以维护 $\log_2 \omega$ ，在输出时再转化为 $\log\omega$ 。
<h2>1008. Hints of sd0061</h2>
最慢的情况是 $b$ 的取值为 $0,$ $1,$ $2,$ $3,$ $5,$ $8,$ $\cdots$ 的情况，但事实上也只有 $\mathcal{O}(\log_{1.618}{n})$ 个取值。

从最大的取值到最小的取值依次使用近似线性复杂度的求第 $k$ 小的方法即可，该方法的思想与快排相似，可以保证前 $k - 1$ 小的元素都放置在第 $k$ 小元素的前面，这样枚举的时候就可以依次减少每次的枚举量，时间复杂度 $\displaystyle\mathcal{O}\left(\sum_{i \geq 0}{\frac{n}{1.618^i}}\right) = \mathcal{O}(n)$ 。
<h2>1009. I Curse Myself</h2>
由于图是一个仙人掌，所以显然对于图上的每一个环都需要从环上取出一条边删掉。所以问题就变为有 $M$ 个集合，每个集合里面都有一堆数字，要从每个集合中选择一个恰好一个数加起来。求所有的这样的和中，前 $K$ 大的是哪些。这就是一个经典问题了。

对所有集合两个两个进行合并，设当前合并的集合是 $A$ 和 $B$，合并的过程中用堆来求出当前 $A_{i} + B_{j}$ 的前 $K$ 大值是哪些。这样的复杂度看起来为 $\mathcal{O}(MK \log K)$，但如果合并的时候保证堆内的元素个数是新集合里的元素个数，设每个集合的大小分别为 $m_{0}, m_{1}, \cdots, m_{M-1}$，则复杂度为 $\mathcal{O}(\sum{K \log{m_{i}}}) = \mathcal{O}(K \log{\prod{m_i}})$。当 $m_{i}$ 都相等时取得最大值 $\mathcal{O}\left(MK \log{\frac{\sum{m_i}}{M}}\right)$，所以实际复杂度为 $\mathcal{O}(MK)$。

事实上存在一个时间复杂度 $\mathcal{O}(MK)$ 直接暴力求解的算法，但需要空间复杂度较好，例如空间复杂度 $\mathcal{O}(K)$ 。
<h2>1010. Journey with Knapsack</h2>
标程的做法是生成函数。定义装满 $k$ 体积空间的食物有 $f(k)$ 种方案，对应的生成函数为 $F(z) = \sum_{k \geq 0}{f(k) z^k}$ 。如果我们可以确定多项式 $F(z) \bmod z^{2 n + 1}$ 的系数，那么枚举 $m$ 个装备的体积即可轻松算出答案。

根据乘法原理，第 $i$ 种食物对 $F(z)$ 贡献的因子是 $\displaystyle 1 + z^i + z^{2 i} + \cdots + z^{a_i i} = \frac{1 - z^{(a_i + 1) i}}{1 - z^i}$ ，因此 $\displaystyle F(z) = \prod_{i = 1}^{n}{\frac{1 - z^{(a_i + 1) i}}{1 - z^i}} = \prod_{i = 1}^{n}{\left(1 - z^{(a_i + 1) i}\right)} \prod_{i = 1}^{n}{\frac{1}{1 - z^i}}$ 。

由于 $0 \leq a_1 &lt; a_2 &lt; \cdots &lt; a_n$ 的限制，我们知道对于 $i = 1, 2, \cdots, n$ 有 $a_i \geq i - 1$ ，也即 $(a_i + 1) i \geq i^2$ 。所以只有 $\mathcal{O}(\sqrt{n})$ 项 $\left(1 - z^{(a_i + 1) i}\right)$ 在模 $z^{2 n + 1}$ 意义下不为 $1$ 。你可以利用类似背包的动态规划 $\mathcal{O}(n \sqrt{n})$ 进行计数。

剩下的部分是 $\displaystyle \left(\prod_{i = 1}^{n}{\frac{1}{1 - z^i}}\right) \bmod z^{2 n + 1}$ ，这很像分拆数的生成函数。分拆数的生成函数被定义为 $P(z) = \sum_{k \geq 0}{p(k) z^k}$ ，其中 $p(k)$ 表示 $k$ 的本质不同的拆分数量。五边形数定理表明 $\displaystyle P(z) = 1 + \sum_{k \geq 1}{(-1)^k \left(z^{\frac{k (3 k + 1)}{2}} + z^{\frac{k (3 k - 1)}{2}}\right)}$ ，从而我们可以在需要的时候 $\mathcal{O}(m \sqrt{m})$ 计算出多项式 $P(z) \bmod z^m$ 。

回到原来的部分，我们做如下化简：

$$\displaystyle{\prod_{i = 1}^{n}{\frac{1}{1 - z^i}} \equiv \prod_{i = n + 1}^{2 n}{(1 - z^i)} \prod_{i = 1}^{2 n}{\frac{1}{1 - z^i}} \equiv P(z) \prod_{i = n + 1}^{2 n}{(1 - z^i)} \equiv P(z) \left(1 - \sum_{i = n + 1}^{2 n}{z^i}\right) \pmod{z^{2 n + 1}}}$$

上面的式子表明我们可以利用前缀和将其规约到 $P(z) \bmod z^{2 n + 1}$ 。总的时间复杂度为 $\mathcal{O}(n \sqrt{n})$ 。
<h2>1011. KazaQ's Socks</h2>
找规律即可。规律是 $\underbrace{1, 2, \cdots, n}_{n\text{ numbers}},$ $\underbrace{1, 2, \cdots, n - 1}_{n - 1\text{ numbers}},$ $\underbrace{1, 2, \cdots, n - 2, n}_{n - 1\text{ numbers}},$ $\underbrace{1, 2, \cdots, n - 1}_{n - 1\text{ numbers}},$ $\underbrace{1, 2, \cdots, n - 2, n}_{n - 1\text{ numbers}},$ $\cdots$ 。
<h2>1012. Limited Permutation</h2>
根据 $[l_i, r_i]$ $(1 \leq i \leq n)$ ，我们可以尝试线性地排序并建立一棵笛卡尔树，如果产生矛盾则答案为 $0$ 。

具体来说，我们可以依次找到能够覆盖整个区间 $[L, R]$ 的点 $u$ 。如果找不到则无解。如果找到多个，随便选一个，反正会在之后的决策中被中断。在这棵笛卡尔树上， $u$ 的左孩子（如果存在）应该能覆盖 $[L, u - 1]$ ，同理它的右孩子（如果存在）应该能覆盖 $[u + 1, R]$ ，这意味着我们可以固定区间的一个端点，排序另外一个端点得到孩子节点。最终我们可以建立一棵笛卡尔树。

若存在一棵笛卡尔树，则这棵笛卡尔树是唯一的。每棵子树都基于相似的子问题，所以我们只需要在合并子树时计算子树的组合即可。例如 $u$ 有两个儿子 $v_1$ 和 $v_2$ ，它们的子树对应的方案数分别为 $f(v_1)$ 和 $f(v_2)$ ，子树大小分别为 $s(v_1)$ 和 $s(v_2)$ ，则 $u$ 的子树对应的方案数为 $\displaystyle f(u) = {s(v_1) + s(v_2) \choose s(v_1)} \cdot f(v_1) \cdot f(v_2)$ 。

由于使用基数排序，故处理的时间复杂度为 $\mathcal{O}(n)$ ，主要时间还是花在了读入上面。我们可以加一些读入优化使得复杂度变成 $\mathcal{O}(n \log_{10}{n})$ ，其中 $\log_{10}{n} \leq 6$ 。					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			本条目发布于<a href="http://bestcoder.hdu.edu.cn/blog/2017-multi-university-training-contest-8-solutions-by-%e5%8c%97%e4%ba%ac%e8%88%aa%e7%a9%ba%e8%88%aa%e5%a4%a9%e5%a4%a7%e5%ad%a6/" title="17:00" rel="bookmark"><time class="entry-date" datetime="2017-07-25T17:00:29+00:00">2017年7月25日</time></a>。属于<a href="http://bestcoder.hdu.edu.cn/blog/category/duoxiao/" rel="category tag">多校题解</a>分类。<span class="by-author">作者是<span class="author vcard"><a class="url fn n" href="http://bestcoder.hdu.edu.cn/blog/author/sensible/" title="查看所有由sensible发布的文章" rel="author">sensible</a></span>。</span>								</footer><!-- .entry-meta -->
	</article><!-- #post -->
			
					<nav id="nav-below" class="navigation" role="navigation">
			<h3 class="assistive-text">文章导航</h3>
			<div class="nav-previous"><a href="http://bestcoder.hdu.edu.cn/blog/page/2/" ><span class="meta-nav">&larr;</span> 早期文章</a></div>
			<div class="nav-next"></div>
		</nav><!-- .navigation -->
	
		
		</div><!-- #content -->
	</div><!-- #primary -->


			<div id="secondary" class="widget-area" role="complementary">
			<aside id="search-2" class="widget widget_search"><form role="search" method="get" id="searchform" class="searchform" action="http://bestcoder.hdu.edu.cn/blog/">
				<div>
					<label class="screen-reader-text" for="s">搜索：</label>
					<input type="text" value="" name="s" id="s" />
					<input type="submit" id="searchsubmit" value="搜索" />
				</div>
			</form></aside>		<aside id="recent-posts-2" class="widget widget_recent_entries">		<h3 class="widget-title">近期文章</h3>		<ul>
					<li>
				<a href="http://bestcoder.hdu.edu.cn/blog/2017-multi-university-training-contest-2-solutions-by-%e7%94%b5%e5%ad%90%e7%a7%91%e6%8a%80%e5%a4%a7%e5%ad%a6/">2017 Multi-University Training Contest 2 solutions BY 电子科技大学</a>
						</li>
					<li>
				<a href="http://bestcoder.hdu.edu.cn/blog/2017-multi-university-training-contest-8-solutions-by-%e5%8c%97%e4%ba%ac%e8%88%aa%e7%a9%ba%e8%88%aa%e5%a4%a9%e5%a4%a7%e5%ad%a6/">2017 Multi-University Training Contest 1 solutions BY 北京航空航天大学</a>
						</li>
					<li>
				<a href="http://bestcoder.hdu.edu.cn/blog/2016-multi-university-training-contest-9-solutions-by-%e9%87%91%e7%ad%96%e5%b7%a5%e4%b8%9a%e7%bb%bc%e5%90%88%e5%a4%a7%e5%ad%a6/">2016 Multi-University Training Contest 9 solutions BY 金策工业综合大学</a>
						</li>
					<li>
				<a href="http://bestcoder.hdu.edu.cn/blog/2016-multi-university-training-contest-8-solutions-by-%e5%ad%a6%e5%86%9b%e4%b8%ad%e5%ad%a6/">2016 Multi-University Training Contest 8 solutions BY 学军中学</a>
						</li>
					<li>
				<a href="http://bestcoder.hdu.edu.cn/blog/2016-multi-university-training-contest-7-solutions-by-sysu/">2016 Multi-University Training Contest 7 solutions BY SYSU</a>
						</li>
				</ul>
		</aside>		<aside id="categories-2" class="widget widget_categories"><h3 class="widget-title">分类目录</h3>		<ul>
	<li class="cat-item cat-item-7"><a href="http://bestcoder.hdu.edu.cn/blog/category/acmicpc-asia-regional-%e7%bd%91%e8%b5%9b%e9%a2%98%e8%a7%a3/" >ACM/ICPC Asia Regional 网赛题解</a>
</li>
	<li class="cat-item cat-item-11"><a href="http://bestcoder.hdu.edu.cn/blog/category/duoxiao/" >多校题解</a>
</li>
	<li class="cat-item cat-item-1"><a href="http://bestcoder.hdu.edu.cn/blog/category/uncategorized/" >未分类</a>
</li>
		</ul>
</aside>		</div><!-- #secondary -->
		</div><!-- #main .wrapper -->
	<footer id="colophon" role="contentinfo">
		<div class="site-info">
						<a href="https://cn.wordpress.org/" title="优雅的个人发布平台">自豪地采用WordPress</a>
		</div><!-- .site-info -->
	</footer><!-- #colophon -->
</div><!-- #page -->
<script src="http://acm.hdu.edu.cn/assets/js/marked.min.js"></script>
<script src="http://acm.hdu.edu.cn/assets/js/katex.min.js"></script>
<script src="http://acm.hdu.edu.cn/assets/js/auto-render.min.js"></script>
<script src="http://acm.hdu.edu.cn/assets/js/wordpress.js"></script>
<script type='text/javascript' src='http://bestcoder.hdu.edu.cn/blog/wp-content/themes/twentytwelve/js/navigation.js?ver=20140711'></script>
<script type='text/javascript' src='http://bestcoder.hdu.edu.cn/blog/wp-includes/js/wp-embed.min.js?ver=4.5.4'></script>
</body>
</html>?05           Y{2>>       "    :http://bestcoder.hdu.edu.cn/blog/ request-method GET response-head HTTP/1.1 200 OK
Date: Fri, 28 Jul 2017 12:43:51 GMT
Server: Apache
X-Powered-By: PHP/5.2.17
Link: <http://bestcoder.hdu.edu.cn/blog/wp-json/>; rel="https://api.w.org/"
Content-Type: text/html; charset=UTF-8
X-Cache: MISS from wwwcache1.hdu.edu.cn
Via: 1.1 wwwcache1.hdu.edu.cn (squid/3.5.22)
 charset UTF-8 uncompressed-len 0 predictor::resource-count 18 predictor::http://bestcoder.hdu.edu.cn/blog/wp-content/themes/twentytwelve/style.css?ver=4.5.4 1,1,0,0 predictor::http://bestcoder.hdu.edu.cn/blog/wp-includes/js/jquery/jquery.js?ver=1.12.4 1,1,0,0 predictor::http://bestcoder.hdu.edu.cn/blog/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1 1,1,0,0 predictor::http://acm.hdu.edu.cn/assets/css/katex.min.css 1,1,0,0 predictor::http://bestcoder.hdu.edu.cn/blog/wp-includes/js/wp-emoji-release.min.js?ver=4.5.4 1,1,0,0 predictor::http://bestcoder.hdu.edu.cn/blog/wp-content/uploads/2017/07/1.png 1,1,0,0 predictor::http://bestcoder.hdu.edu.cn/blog/wp-content/uploads/2017/07/2.png 1,1,0,0 predictor::http://bestcoder.hdu.edu.cn/blog/wp-content/uploads/2017/07/3-300x144.png 1,1,0,0 predictor::http://acm.hdu.edu.cn/assets/js/marked.min.js 1,1,0,0 predictor::http://acm.hdu.edu.cn/assets/js/katex.min.js 1,1,0,0 predictor::http://acm.hdu.edu.cn/assets/js/auto-render.min.js 1,1,0,0 predictor::http://acm.hdu.edu.cn/assets/js/wordpress.js 1,1,0,0 predictor::http://bestcoder.hdu.edu.cn/blog/wp-content/themes/twentytwelve/js/navigation.js?ver=20140711 1,1,0,0 predictor::http://bestcoder.hdu.edu.cn/blog/wp-includes/js/wp-embed.min.js?ver=4.5.4 1,1,0,0 predictor::http://acm.hdu.edu.cn/assets/css/fonts/KaTeX_Size1-Regular.woff2 1,1,0,0 predictor::http://acm.hdu.edu.cn/assets/css/fonts/KaTeX_Size3-Regular.woff2 1,1,0,0 predictor::http://acm.hdu.edu.cn/assets/css/fonts/KaTeX_Size2-Regular.woff2 1,1,0,0 predictor::http://acm.hdu.edu.cn/assets/css/fonts/KaTeX_Size4-Regular.woff2 1,1,0,0   